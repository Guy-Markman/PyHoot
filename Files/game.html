<!doctype html>
<html>

	<head>

		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<title>PyHoot!</title>
		<link rel="icon" type="image/png" href="icon.png">
		<link rel="stylesheet" type="text/css" href="game.css" />
		<link href="https://fonts.googleapis.com/css?family=Ravi+Prakash" rel="stylesheet">

		<script src="util.js"></script>
		<script>
			var state = "wait";
			var exteranl = "";
			check_move_to_next();

			function disconnect_user() {
				xmlrequest("diconnect_user", function() {
					if (this.readyState == 4) {
						window.location.href = '/';
					}
				});
			}

			function switch_screens() {
				switch (state) {
					case "question":
						to = "leaderboard";
						color = "green";
						break;
					case "leaderboard":
						to = "question";
						color = "white"
						break;
					case "wait":
						to = "question";
						color = "white"
						break;
					case "wait_question":
						state = "wait";
						to = "leaderboard";
						color = "green"
						break;
				}
				var from_style_display = document.getElementById(state).style.display;
				var to_style_display = document.getElementById(to).style.display;
				from_style_display = [to_style_display, to_style_display = from_style_display][0];
				document.getElementById(state).style.display = from_style_display;
				document.getElementById(to).style.display = to_style_display;
				document.body.style.background = color
			}

			function send_answer(letter) {
				xmlrequest("answer?letter=" + letter,
					function() {
						if (this.readyState == 4 && this.status == 200) {
							state = "wait";
							switch_screens();
							//HACK: This is a bad way to do this. I must find better one.
							document.body.style.background = "purple"
							state = "wait_question";
						}
					}
				);
			}

			function get_score() {
				xmlrequest("get_score",
					function() {
						if (this.readyState == 4 && this.status == 200) {
							var score_place = parse_xml_from_string(this.responseText).getElementsByTagName("score_place")[0];
							document.getElementById("score").innerHTML = score_place.getAttribute("score");
							document.getElementById("place").innerHTML = ordinal_suffix_of(score_place.getAttribute("place"));
						}
					}
				);
			}

			function ordinal_suffix_of(i) {
				var j = i % 10,
					k = i % 100;
				if (j == 1 && k != 11) {
					return i + "st";
				}
				if (j == 2 && k != 12) {
					return i + "nd";
				}
				if (j == 3 && k != 13) {
					return i + "rd";
				}
				return i + "th";
			}

			function check_move_to_next() {
				xmlrequest("check_move_next_page",
					function() {
						if (this.readyState == 4 && this.status == 200) {
							if (xmlstring_to_boolean(this.responseText)) {
								switch (state) {
									case "wait":
										switch_screens();
										state = "questions";
										xmlrequest("moved_to_next_question", null);
										break;
									case "question":
										switch_screens();
										state = "leaderboard";
										xmlrequest("moved_to_next_question", null);
										break;
									case "wait_question":
										get_score();
										switch_screens();
										state = "leaderboard";
										xmlrequest("moved_to_next_question", null);
										break;
									case "leaderboard":
										switch_screens();
										xmlrequest("moved_to_next_question", null);
										state = "question";
										break;
								}
							}
						}
					}
				);
				setTimeout(check_move_to_next, 1000);
			}
		</script>
	</head>

	<body>
		<center>
			<div id="wait" style="display:inline">
				<!--Will check when it should switch to question everysecond-->
				<p class="wait">Please wait</p>
				<br /><br />
				<input type="button" value="Disconnect" class="leave" onclick="disconnect_user();" />
			</div>
			<div id="question">
				<table>
					<tr>
						<td>
							<button type="button" class="button_A" onclick="send_answer('A');">
								A
							</button>
						</td>
						<td>
							<button type="button" class="button_B" onclick="send_answer('B');">
								B
							</button>
						</td>
					</tr>
					<tr>
						<td>
							<button type="button" class="button_C" onclick="send_answer('C');">
								C
							</button>
						</td>
						<td>
							<button type="button" class="button_D" onclick="send_answer('D');">
								D
							</button>
						</td>
					</tr>
				</table>
			</div>
			<div id="leaderboard">
				<p class="leaderboard">Your score right now is </p>
				<p class="leaderboard" id="score"></p><br />
				<p class="leaderboard">and you are </p>
				<p class="leaderboard" id="place"></p>
				<p class="leaderboard"> place</p>
				<br/><br/>
				<button type="button" class="leave" onclick="disconnect_user();">
					Leave the game
				</button>
			</div>
		</center>
	</body>

</html>
